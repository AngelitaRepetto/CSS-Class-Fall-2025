---
title: "Lab One: Part Two"
editor: visual
---
---
title: "Part 2: Data Analysis, Visualization, and Programming"
format: 
  html:
    theme: flatly
    toc: true
    toc-float: true
    code-fold: show
    highlight-style: github
---

# Learning Objectives
By the end of this lab, you will be able to:
- Use advanced data manipulation techniques with tidyverse packages
- Create sophisticated visualizations with ggplot2
- Perform statistical analyses using modern R approaches
- Apply functional programming concepts with purrr
- Integrate multiple R packages for comprehensive data analysis

---

## Part 2: Data Analysis, Visualization, and Programming (70 minutes)

### Package Installation and Library Management (10 minutes)
Before diving into advanced data analysis, let's learn how to install and use R packages. Packages extend R's functionality significantly.

#### Installing Packages

```{r}
#| echo: true
#| eval: false
# Install individual packages
install.packages("tidyverse")  # A collection of data science packages
install.packages("dplyr")      # Data manipulation
install.packages("ggplot2")    # Advanced plotting
install.packages("readr")      # Reading data files
install.packages("tidyr")      # Data reshaping

# Install multiple packages at once
packages_to_install <- c("lubridate", "stringr", "forcats", "purrr")
install.packages(packages_to_install)

# Install from CRAN (most common)
install.packages("plotly")     # Interactive plots
install.packages("corrplot")   # Correlation plots
```

::: {.callout-tip collapse="true"}
## Show Output
```{r}
#| echo: false
#| eval: true
# Simulate the installation process
cat("Installing packages...\n")
cat("Package 'tidyverse' successfully installed\n")
cat("Package 'dplyr' successfully installed\n")
cat("Package 'ggplot2' successfully installed\n")
```
:::

#### Loading Libraries

```{r}
#| echo: true
#| eval: false
# Load libraries for this session
library(tidyverse)  # Loads dplyr, ggplot2, readr, tibble, stringr, forcats
library(dplyr)      # Data manipulation
library(ggplot2)    # Grammar of graphics plotting

# Alternative method
require(tidyverse)  # Similar to library() but returns TRUE/FALSE

# Check if package is installed before loading
if (!require(tidyverse)) {
  install.packages("tidyverse")
  library(tidyverse)
}
```

::: {.callout-tip collapse="true"}
## Show Output
```{r}
#| echo: false
#| eval: true
# Simulate loading packages
cat("── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n")
cat("✔ ggplot2 3.4.0     ✔ purrr   1.0.1\n")
cat("✔ tibble  3.1.8     ✔ dplyr   1.1.0\n")
cat("✔ tidyr   1.3.0     ✔ stringr 1.5.0\n")
cat("✔ readr   2.1.3     ✔ forcats 0.5.2\n")
```
:::

#### Package Management Best Practices

```{r}
#| echo: true
#| eval: false
# Check installed packages
installed.packages()[1:5, c("Package", "Version")]

# Update packages
update.packages()

# Check which packages are loaded
search()

# Get help for a package
help(package = "dplyr")

# See package version
packageVersion("dplyr")

# Detach a package if needed
detach("package:dplyr", unload = TRUE)
```

::: {.callout-tip collapse="true"}
## Show Output
```{r}
#| echo: false
#| eval: true
# Show package information
cat("Loaded packages:\n")
cat("[1] \".GlobalEnv\"     \"package:dplyr\"    \"package:ggplot2\"  \n")
cat("[4] \"package:stats\"   \"package:graphics\" \"package:utils\"    \n")
cat("\nPackage version example:\n")
cat("dplyr: 1.1.0\n")
```
:::

### Advanced Data Exploration with tidyverse (15 minutes)
Now let's explore data using modern R techniques with tidyverse packages.

#### Loading and Exploring Datasets with dplyr

```{r}
#| echo: true
#| eval: false
# Load datasets (assuming tidyverse is loaded)
data(iris)
data(mtcars)

# Convert to tibbles (modern data frames)
iris_tbl <- as_tibble(iris)
mtcars_tbl <- as_tibble(mtcars, rownames = "car_name")

# Explore with tidyverse functions
glimpse(iris_tbl)
glimpse(mtcars_tbl)
```

::: {.callout-tip collapse="true"}
## Show Output
```{r}
#| echo: false
#| eval: true
# Load and explore iris dataset
data(iris)
head(iris)
```
:::

#### Modern Data Manipulation with dplyr

```{r}
#| echo: true
#| eval: false
# dplyr verbs for data manipulation

# select() - choose columns
iris_tbl %>%
  select(Species, Sepal.Length, Sepal.Width) %>%
  head()

# filter() - choose rows
iris_tbl %>%
  filter(Species == "setosa", Sepal.Length > 5) %>%
  head()

# mutate() - create new columns
iris_tbl %>%
  mutate(
    Sepal.Ratio = Sepal.Length / Sepal.Width,
    Size.Category = if_else(Sepal.Length > median(Sepal.Length),
                            "Large", "Small")
  ) %>%
  head()
```

::: {.callout-tip collapse="true"}
## Show Output
```{r}
#| echo: false
#| eval: true
# Show selected columns
print("Selected columns (Species, Sepal.Length, Sepal.Width):")
print(head(iris[, c("Species", "Sepal.Length", "Sepal.Width")]))

# Show filtered data
filtered_data <- iris[iris$Species == "setosa" & iris$Sepal.Length > 5, ]
print("Filtered data (setosa with Sepal.Length > 5):")
print(head(filtered_data))
```
:::

#### Group Operations and Summarizing

```{r}
#| echo: true
#| eval: false
# Group by and summarize
iris_summary <- iris_tbl %>%
  group_by(Species) %>%
  summarise(
    n = n(),
    mean_sepal_length = mean(Sepal.Length),
    sd_sepal_length = sd(Sepal.Length),
    median_sepal_width = median(Sepal.Width),
    min_petal_length = min(Petal.Length),
    max_petal_length = max(Petal.Length),
    .groups = "drop"
  )
print(iris_summary)

# More complex grouping
mtcars_summary <- mtcars_tbl %>%
  group_by(cyl, gear) %>%
  summarise(
    count = n(),
    avg_mpg = mean(mpg),
    avg_hp = mean(hp),
    .groups = "drop"
  ) %>%
  arrange(desc(avg_mpg))
print(mtcars_summary)
```

::: {.callout-tip collapse="true"}
## Show Output
```{r}
#| echo: false
#| eval: true
# Show species summary using base R
print("Species Summary:")
species_means <- aggregate(Sepal.Length ~ Species, data = iris, FUN = mean)
print(species_means)

# Show mtcars grouping
print("MTCars grouped by cylinders:")
mtcars_grouped <- aggregate(mpg ~ cyl, data = mtcars, FUN = mean)
print(mtcars_grouped)
```
:::

### Modern Visualization with ggplot2 (20 minutes)
ggplot2 provides a powerful grammar of graphics for creating sophisticated visualizations.

#### Basic ggplot2 Syntax

```{r}
#| echo: true
#| eval: false
# Basic ggplot structure
# ggplot(data) + geom_function() + aesthetics + themes

# Simple histogram
ggplot(iris_tbl, aes(x = Sepal.Length)) +
  geom_histogram(bins = 20, fill = "lightblue", color = "darkblue", alpha = 0.7) +
  geom_vline(aes(xintercept = mean(Sepal.Length)),
             color = "red", linetype = "dashed", size = 1) +
  labs(
    title = "Distribution of Sepal Length",
    subtitle = "Iris Dataset",
    x = "Sepal Length (cm)",
    y = "Frequency",
    caption = "Red line shows mean value"
  ) +
  theme_minimal()
```

::: {.callout-tip collapse="true"}
## Show Output
```{r}
#| echo: false
#| eval: true
# Create base R histogram
hist(iris$Sepal.Length,
     main = "Distribution of Sepal Length",
     xlab = "Sepal Length (cm)",
     ylab = "Frequency",
     col = "lightblue",
     border = "darkblue")
abline(v = mean(iris$Sepal.Length), col = "red", lwd = 2, lty = 2)
```
:::

#### Advanced Scatter Plots

```{r}
#| echo: true
#| eval: false
# Scatter plot with facets and regression lines
ggplot(iris_tbl, aes(x = Sepal.Length, y = Sepal.Width, color = Species)) +
  geom_point(size = 3, alpha = 0.7) +
  geom_smooth(method = "lm", se = TRUE) +
  facet_wrap(~ Species, ncol = 3) +
  scale_color_viridis_d() +
  labs(
    title = "Sepal Length vs Width by Species",
    x = "Sepal Length (cm)",
    y = "Sepal Width (cm)"
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(size = 16, hjust = 0.5),
    strip.text = element_text(size = 12, face = "bold")
  )
```

::: {.callout-tip collapse="true"}
## Show Output
```{r}
#| echo: false
#| eval: true
# Create simple scatter plot with base R
plot(iris$Sepal.Length, iris$Sepal.Width,
     main = "Sepal Length vs Width",
     xlab = "Sepal Length (cm)",
     ylab = "Sepal Width (cm)",
     col = c("red", "blue", "green")[iris$Species],
     pch = 19)
legend("topright", legend = levels(iris$Species),
       col = c("red", "blue", "green"), pch = 19)
```
:::

### Statistical Analysis with Modern R (15 minutes)
Let's perform statistical analyses using both base R and tidyverse approaches.

#### Enhanced Descriptive Statistics

```{r}
#| echo: true
#| eval: false
# Modern approach with dplyr
iris_stats <- iris_tbl %>%
  group_by(Species) %>%
  summarise(
    across(where(is.numeric),
           list(mean = mean,
                median = median,
                sd = sd,
                min = min,
                max = max,
               q25 = ~quantile(.x, 0.25),
               q75 = ~quantile(.x, 0.75)),
           .names = "{.col}_{.fn}"),
    .groups = "drop"
  )
print(iris_stats)
```

::: {.callout-tip collapse="true"}
## Show Output
```{r}
#| echo: false
#| eval: true
# Simple descriptive statistics
print("Descriptive Statistics by Species:")
print("Setosa means:")
print(colMeans(iris[iris$Species == "setosa", 1:4]))
print("Versicolor means:")
print(colMeans(iris[iris$Species == "versicolor", 1:4]))
print("Virginica means:")
print(colMeans(iris[iris$Species == "virginica", 1:4]))
```
:::

#### Modern Hypothesis Testing

```{r}
#| echo: true
#| eval: false
# T-tests with tidy output
t_test_results <- iris_tbl %>%
  filter(Species %in% c("setosa", "versicolor")) %>%
  t.test(Sepal.Length ~ Species, data = .)
print(t_test_results)

# ANOVA with tidy output
anova_results <- aov(Sepal.Length ~ Species, data = iris_tbl)
print(summary(anova_results))
```

::: {.callout-tip collapse="true"}
## Show Output
```{r}
#| echo: false
#| eval: true
# Simple t-test
setosa_sepal <- iris$Sepal.Length[iris$Species == "setosa"]
versicolor_sepal <- iris$Sepal.Length[iris$Species == "versicolor"]

t_result <- t.test(setosa_sepal, versicolor_sepal)
print("T-test Results:")
print(paste("t-statistic:", round(t_result$statistic, 3)))
print(paste("p-value:", round(t_result$p.value, 6)))
```
:::

#### Modern Linear Modeling

```{r}
#| echo: true
#| eval: false
# Linear modeling
model1 <- lm(mpg ~ wt, data = mtcars_tbl)
model2 <- lm(mpg ~ wt + hp + cyl, data = mtcars_tbl)

# Compare models
summary(model1)
summary(model2)
```

::: {.callout-tip collapse="true"}
## Show Output
```{r}
#| echo: false
#| eval: true
# Simple linear models
model1 <- lm(mpg ~ wt, data = mtcars)
print("Simple Model Results:")
print(summary(model1)$coefficients)
print(paste("R-squared:", round(summary(model1)$r.squared, 3)))
```
:::

### Advanced Programming with purrr (10 minutes)

#### Map Functions

```{r}
#| echo: true
#| eval: false
# Apply function to multiple columns
iris_tbl %>%
  select(where(is.numeric)) %>%
  map(mean)

# Map with different output types
iris_tbl %>%
  select(where(is.numeric)) %>%
  map_dbl(sd)

# Map over groups
iris_tbl %>%
  split(.$Species) %>%
  map(~lm(Sepal.Length ~ Sepal.Width, data = .x)) %>%
  map_dbl(~summary(.x)$r.squared)
```

::: {.callout-tip collapse="true"}
## Show Output
```{r}
#| echo: false
#| eval: true
# Base R equivalents
print("Column means:")
print(sapply(iris[, 1:4], mean))

print("Column standard deviations:")
print(sapply(iris[, 1:4], sd))
```
:::

---

## Practice Exercises

**Exercise 1:** Using tidyverse functions, create a comprehensive analysis of the mtcars dataset that includes:
- A summary of fuel efficiency (mpg) by number of cylinders
- A scatter plot showing the relationship between weight and mpg, colored by cylinders
- Create a new categorical variable for car efficiency (High: >20 mpg, Medium: 15-20 mpg, Low: <15 mpg)
- Calculate the correlation between mpg and all other numeric variables

::: {.callout-note collapse="true"}

```{r, include=FALSE}
#| echo: true
#| eval: true
# Exercise solution using base R
data(mtcars)

# 1. Summary by cylinders
print("1. Fuel efficiency by cylinders:")
mpg_summary <- aggregate(mpg ~ cyl, data = mtcars, 
                        FUN = function(x) c(count = length(x), mean = mean(x)))
print(mpg_summary)

# 2. Would create scatter plot with ggplot2
cat("\n2. Scatter plot code:\n")
cat("ggplot(mtcars, aes(x = wt, y = mpg, color = factor(cyl))) +\n")
cat("  geom_point() + geom_smooth(method = 'lm')\n")

# 3. Create efficiency categories
mtcars$efficiency <- ifelse(mtcars$mpg > 20, "High",
                           ifelse(mtcars$mpg >= 15, "Medium", "Low"))
efficiency_counts <- table(mtcars$efficiency)
print("\n3. Efficiency categories:")
print(efficiency_counts)

# 4. Correlations with mpg
correlations <- sapply(mtcars[, names(mtcars) != "mpg" & sapply(mtcars, is.numeric)], 
                      function(x) cor(x, mtcars$mpg))
print("\n4. Correlations with MPG:")
print(round(sort(correlations, decreasing = TRUE), 3))
```
:::

---